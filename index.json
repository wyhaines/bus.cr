{"repository_name":"bus","body":"# bus\n\n![Bus.cr CI](https://img.shields.io/github/workflow/status/wyhaines/bus.cr/bus.cr%20CI?style=for-the-badge&logo=GitHub)\n[![GitHub release](https://img.shields.io/github/release/wyhaines/bus.cr.svg?style=for-the-badge)](https://github.com/wyhaines/bus.cr/releases)\n![GitHub commits since latest release (by SemVer)](https://img.shields.io/github/commits-since/wyhaines/bus.cr/latest?style=for-the-badge)\n\n\nThis class implements an in-process pubsub style message bus.\n\nThe bus receives messages and routes them to all interested handlers. Additionally, the bus is capable of dispatching the message to only a subset of potential handlers, based on a best-fit, or to all eligible handlers.\n\n## Handler Selection & Winner Selection Protocol\n\nImagine that there are multiple subscribers for a given type of message (a given tag), but the message being dispatched should only be handled by a single subscriber. This implementation puts the responsibility on each handler to respond to an \"evaluate\" request on a message on two axex.\n\nThe first axis is relevance, which is a measure of how appropriate the subject of the message is to the purpose of the handler. For example, an HTTP request might be highly relevant to both a static asset handler and an API endpoint, and not at all relevant to a handler that proxies database requests.\n\nThe second axis is confidence. It reflects how sure the handler is that it can return a valid response to the message. In the aforementioned examples, a static handler that doesn't have any assets that can fullfill the request would have a very low confidence, while one that does have available assets would have a high confidence. Likewise, the API endpoint handler would return a high confidence if it had an endpoint that matched the request.\n\nWhen a handler receives a message that hasn't been evaluated, the handler should return an evaluation response that indicates it's relevance and confidence.\n\nAfter the bus has received evaluation responses from all of the handlers which initially received the message, it will select one or more *winners* which will each be passed the message for handling.\n\nHandlers can choose to arbitrarily opt in to receiving a message, or to opt out of consideration.\n\nEverything that opts out has no chance of recieving a message. Everything that opts in will always receive the message (something which may be useful for a logging handler).\n\nAll other handlers will be sorted by relevance and confidence, from high to low. The set of potential winners is all of the handlers who have the same highest relevance and confidence.\n\nBy default, if there is a tie, the bus picks a handler at random to receive the message. The other options are to just go with whichever handler happens to be first in the list, or to send messages to all handlers.\n\n## Thread Safety\n\nThe Bus implementation should be thread safe, as should be the CSUUID and SplayTreMap implementations, but there are parts of Crystal that are not currently thread safe, so your mileage may vary.\n\nFor instance, it is possible to eke out a little more performance by replacing all of the SplayTreeMap usage with Hash, but under multithreaded conditions, the Hash can exhibit catastrophic failures, particularly in combination with `--release`. The SplayTreeMap does not exhibit these failures, and future developments with it may make it faster than the Hash for it's intended purpose (as a cache of sorts), so it remains in use.\n## Installation\n\n1. Add the dependency to your `shard.yml`:\n\n   ```yaml\n   dependencies:\n     bus:\n       github: your-github-user/bus\n   ```\n\n2. Run `shards install`\n\n## Usage\n\n```crystal\nrequire \"bus\"\n```\n\nCreate a new Bus.\n\n```crystal\nbus = Bus.new\n```\n\nCreate a subclass of Bus::Handler to handle messages.\n\n```crystal\nclass TestHandler < Bus::Handler\n  ResultsChannel = Bus::Pipeline(Bus::Message).new(10)\n\n  def handle(msg)\n    msg.body << \"Handled by #{self}\"\n    ResultsChannel.send(msg)\n  end\nend\n```\n\nCreate a handler instance, and connect it to the bus all in one line.\n\n```crystal\nhandler_1 = TestHandler.new(bus: bus, tags: [\"handler\", \"handler1\"])\n```\n\nAlternatively, do it as separate steps.\n\n```crystal\nhandler_2 = TestHandler.new(tags: [\"handler\", \"handler2\"])\nhandler_2.subscribe(bus)\n```\n\nCreate a message, targetted at all of the handlers with the `handler` tag.\n\n```crystal\nmessage = Bus::Message.new(\n  body: [\"One or more\",\"Strings of text\"],\n  tags: [\"handler\"],\n  parameters: {\n    \"hash\" => \"of\",\n    \"arbitrary\" => \"data\"\n  }\n)\n```\n\nAnd send it.\n\n```crystal\nbus.send(message)\n```\n\nAlternatively, do it all from the `Bus`.\n\n```crystal\nbus.send(\n  body: [\"One or more\",\"Strings of text\"],\n  tags: [\"handler\"],\n  parameters: {\n    \"hash\" => \"of\",\n    \"arbitrary\" => \"data\"\n  }\n)\n```\n\nIn your handlers, you probably want to implement an `#evaluate` method to determine relevance and confidence for the handler. The `origin` on a pipeline is a UUID that uniquely identifies it. When sending an evaluation, the `receiver` parameter is the origin of the Pipeline that received (and is responding to) the message.\n\n```crystal\nclass TestHandler < Bus::Handler\n  def evaluate(msg)\n    ppl = @pipeline\n\n    if will_handle?(msg)\n      msg.send_evaluation(\n        relevance: 0,\n        certainty: 1000000,\n        receiver: ppl.origin\n      ) if ppl\n    else\n      msg.send_evaluation(\n        relevance: -1000000,\n        certainty: -1000000,\n        receiver: ppl.origin\n      ) if ppl\n    end\n  end\nend\n\n```\n\nA handler that has received a message can send a message that will go back to the handler that originally sent the message:\n\n```crystal\nmessage.reply(\n  body: \"Confirmation\",\n  parameters: {\"timestamp\" => Time.local.to_s}\n)\n```\n\n## Development\n\nTODO: Write development instructions here\n\n## Contributing\n\n1. Fork it (<https://github.com/your-github-user/bus/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Kirk Haines](https://github.com/your-github-user) - creator and maintainer\n\n![GitHub code size in bytes](https://img.shields.io/github/languages/code-size/wyhaines/bus.cr?style=for-the-badge)\n![GitHub issues](https://img.shields.io/github/issues/wyhaines/bus.cr?style=for-the-badge)\n","program":{"html_id":"bus/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"bus","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"bus/Bus","path":"Bus.html","kind":"class","full_name":"Bus","name":"Bus","abstract":false,"superclass":{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus.cr","line_number":9,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L9"},{"filename":"src/bus/confidence.cr","line_number":1,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L1"},{"filename":"src/bus/evaluation.cr","line_number":5,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L5"},{"filename":"src/bus/handler.cr","line_number":3,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L3"},{"filename":"src/bus/message.cr","line_number":4,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L4"},{"filename":"src/bus/pipeline.cr","line_number":3,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L3"},{"filename":"src/bus/version.cr","line_number":1,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L1"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.1\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"####\nA Bus sends messages to interested subscribers. Those subscribers\ncan reply to a message. Those replies will be routed back to the\noriginal sender.","summary":"<h4><a id=\"a-bus-sends-messages-to-interested-subscribers.\" class=\"anchor\" href=\"#a-bus-sends-messages-to-interested-subscribers.\">\n  <svg class=\"octicon-link\" aria-hidden=\"true\">\n    <use href=\"#octicon-link\"/>\n  </svg>\n</a>A Bus sends messages to interested subscribers.</h4>","class_methods":[],"constructors":[{"html_id":"new-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus.cr","line_number":18,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L18"},"def":{"name":"new","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"has_subscription?(key)-instance-method","name":"has_subscription?","doc":null,"summary":null,"abstract":false,"args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":""}],"args_string":"(key)","args_html":"(key)","location":{"filename":"src/bus.cr","line_number":37,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L37"},"def":{"name":"has_subscription?","args":[{"name":"key","doc":null,"default_value":"","external_name":"key","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@subscriptions.has_key?(key)"}},{"html_id":"message(body:Array(String)|String,origin:String?=nil,tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,strategy:Message::Strategy=Message::Strategy::RandomWinner)-instance-method","name":"message","doc":"Generate a message for this bus.","summary":"<p>Generate a message for this bus.</p>","abstract":false,"args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"Array(String) | String"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"strategy","doc":null,"default_value":"Message::Strategy::RandomWinner","external_name":"strategy","restriction":"Message::Strategy"}],"args_string":"(body : Array(String) | String, origin : String? = nil, tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, strategy : Message::Strategy = Message::Strategy::RandomWinner)","args_html":"(body : Array(String) | String, origin : String? = <span class=\"n\">nil</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, strategy : <a href=\"Bus/Message/Strategy.html\">Message::Strategy</a> = <span class=\"t\">Message</span><span class=\"t\">::</span><span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus.cr","line_number":121,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L121"},"def":{"name":"message","args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"Array(String) | String"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"strategy","doc":null,"default_value":"Message::Strategy::RandomWinner","external_name":"strategy","restriction":"Message::Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Message.new(body: body, origin: origin, tags: tags, parameters: parameters, pipeline: @pipeline, strategy: strategy)"}},{"html_id":"origin_tag-instance-method","name":"origin_tag","doc":"Generate a random UUID that does not already exist in the subscriptions.","summary":"<p>Generate a random UUID that does not already exist in the subscriptions.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus.cr","line_number":30,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L30"},"def":{"name":"origin_tag","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"loop do\n  id = UUID.random.to_s\n  if !(has_subscription?(id))\n    break id\n  end\nend"}},{"html_id":"pipeline:Pipeline(Message)-instance-method","name":"pipeline","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Pipeline(Message)","args_html":" : <a href=\"Bus/Pipeline.html\">Pipeline</a>(<a href=\"Bus/Message.html\">Message</a>)","location":{"filename":"src/bus.cr","line_number":16,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L16"},"def":{"name":"pipeline","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Pipeline(Message)","visibility":"Public","body":"@pipeline"}},{"html_id":"send(body:Array(String)|String,origin:String?=nil,tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,strategy:Message::Strategy=Message::Strategy::RandomWinner)-instance-method","name":"send","doc":null,"summary":null,"abstract":false,"args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"Array(String) | String"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"strategy","doc":null,"default_value":"Message::Strategy::RandomWinner","external_name":"strategy","restriction":"Message::Strategy"}],"args_string":"(body : Array(String) | String, origin : String? = nil, tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, strategy : Message::Strategy = Message::Strategy::RandomWinner)","args_html":"(body : Array(String) | String, origin : String? = <span class=\"n\">nil</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, strategy : <a href=\"Bus/Message/Strategy.html\">Message::Strategy</a> = <span class=\"t\">Message</span><span class=\"t\">::</span><span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus.cr","line_number":138,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L138"},"def":{"name":"send","args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"Array(String) | String"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"strategy","doc":null,"default_value":"Message::Strategy::RandomWinner","external_name":"strategy","restriction":"Message::Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"send(message(body: body, origin: origin, tags: tags, parameters: parameters, strategy: strategy))"}},{"html_id":"send(message:Message)-instance-method","name":"send","doc":"Send a message to the subscribers","summary":"<p>Send a message to the subscribers</p>","abstract":false,"args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"Message"}],"args_string":"(message : Message)","args_html":"(message : <a href=\"Bus/Message.html\">Message</a>)","location":{"filename":"src/bus.cr","line_number":157,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L157"},"def":{"name":"send","args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"Message"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if message.pipeline.nil?\n  message.pipeline = @pipeline\nend\nreceivers = Hash(Pipeline(Message), Bool).new\nmessage.tags.each do |tag|\n  if @subscriptions.has_key?(tag)\n    @subscriptions[tag].each_key do |receiver|\n      receivers[receiver] = true\n    end\n  end\nend\n@pending_evaluation[message.uuid.to_s] = Evaluation.new(message, receivers.keys)\nreceivers.keys.each do |receiver|\n  receiver.send(message)\nend\n"}},{"html_id":"subscribe(tags=[]ofString)-instance-method","name":"subscribe","doc":"Subscribe a new message consumer to the Bus","summary":"<p>Subscribe a new message consumer to the Bus</p>","abstract":false,"args":[{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":""}],"args_string":"(tags = [] of String)","args_html":"(tags = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>)","location":{"filename":"src/bus.cr","line_number":99,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L99"},"def":{"name":"subscribe","args":[{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"pipeline = Pipeline(Message).new(capacity: 1000, origin: origin_tag)\ntags << pipeline.origin\ntags.each do |tag|\n  @subscriptions[tag][pipeline] = true\nend\n@subscribers[pipeline] = tags\npipeline\n"}},{"html_id":"subscriptions:SplayTreeMap(String,Hash(Pipeline(Message),Bool))-instance-method","name":"subscriptions","doc":"As of Crystal 1.0.0, using Hashes here is faster in single threaded\nrelease mode, but it fails UGLY in multithreaded release mode.\nThe SplayTreeMap implementation is currently slightly slower than the\nhash in single threaded, but it works just fine in multithreaded mode,\nso this implementation is going to stick with the SplayTreeMap for now.","summary":"<p>As of Crystal 1.0.0, using Hashes here is faster in single threaded release mode, but it fails UGLY in multithreaded release mode.</p>","abstract":false,"args":[],"args_string":" : SplayTreeMap(String, Hash(Pipeline(Message), Bool))","args_html":" : SplayTreeMap(String, Hash(<a href=\"Bus/Pipeline.html\">Pipeline</a>(<a href=\"Bus/Message.html\">Message</a>), Bool))","location":{"filename":"src/bus.cr","line_number":15,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L15"},"def":{"name":"subscriptions","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"SplayTreeMap(String, Hash(Pipeline(Message), Bool))","visibility":"Public","body":"@subscriptions"}},{"html_id":"unsubscribe(pipeline)-instance-method","name":"unsubscribe","doc":"Remove a message consumer from the Bus","summary":"<p>Remove a message consumer from the Bus</p>","abstract":false,"args":[{"name":"pipeline","doc":null,"default_value":"","external_name":"pipeline","restriction":""}],"args_string":"(pipeline)","args_html":"(pipeline)","location":{"filename":"src/bus.cr","line_number":110,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus.cr#L110"},"def":{"name":"unsubscribe","args":[{"name":"pipeline","doc":null,"default_value":"","external_name":"pipeline","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if tags = @subscribers[pipeline]?\n  tags.each do |tag|\n    hsh = @subscriptions[tag]?\n    hsh.delete(pipeline)\n  end\n  @subscribers.delete(pipeline)\nend"}}],"macros":[],"types":[{"html_id":"bus/Bus/Confidence","path":"Bus/Confidence.html","kind":"struct","full_name":"Bus::Confidence","name":"Confidence","abstract":false,"superclass":{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"bus/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/confidence.cr","line_number":2,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L2"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"html_id":"new(relevance:Int32=0,certainty:Int32=0,force:Bool?=nil)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":"Int32"},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":"Int32"},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":"Bool | ::Nil"}],"args_string":"(relevance : Int32 = 0, certainty : Int32 = 0, force : Bool? = nil)","args_html":"(relevance : Int32 = <span class=\"n\">0</span>, certainty : Int32 = <span class=\"n\">0</span>, force : Bool? = <span class=\"n\">nil</span>)","location":{"filename":"src/bus/confidence.cr","line_number":16,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L16"},"def":{"name":"new","args":[{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":"Int32"},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":"Int32"},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":"Bool | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(relevance, certainty, force)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}},{"html_id":"new(force:Bool?=nil)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":"Bool | ::Nil"}],"args_string":"(force : Bool? = nil)","args_html":"(force : Bool? = <span class=\"n\">nil</span>)","location":{"filename":"src/bus/confidence.cr","line_number":23,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L23"},"def":{"name":"new","args":[{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":"Bool | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(force)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"<=>(val:Confidence):Int32-instance-method","name":"<=>","doc":null,"summary":null,"abstract":false,"args":[{"name":"val","doc":null,"default_value":"","external_name":"val","restriction":"Confidence"}],"args_string":"(val : Confidence) : Int32","args_html":"(val : <a href=\"../Bus/Confidence.html\">Confidence</a>) : Int32","location":{"filename":"src/bus/confidence.cr","line_number":28,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L28"},"def":{"name":"<=>","args":[{"name":"val","doc":null,"default_value":"","external_name":"val","restriction":"Confidence"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"rel = @relevance\nbase_comparison = rel <=> val.relevance\nif base_comparison.zero?\n  cert = @certainty\n  cert <=> val.certainty\nelse\n  base_comparison\nend\n"}},{"html_id":"certainty:Int32-instance-method","name":"certainty","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Int32","args_html":" : Int32","location":{"filename":"src/bus/confidence.cr","line_number":4,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L4"},"def":{"name":"certainty","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"@certainty"}},{"html_id":"force:Bool?-instance-method","name":"force","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Bool?","args_html":" : Bool?","location":{"filename":"src/bus/confidence.cr","line_number":5,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L5"},"def":{"name":"force","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool | ::Nil","visibility":"Public","body":"@force"}},{"html_id":"relevance:Int32-instance-method","name":"relevance","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Int32","args_html":" : Int32","location":{"filename":"src/bus/confidence.cr","line_number":3,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/confidence.cr#L3"},"def":{"name":"relevance","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"@relevance"}}],"macros":[],"types":[]},{"html_id":"bus/Bus/Evaluation","path":"Bus/Evaluation.html","kind":"class","full_name":"Bus::Evaluation","name":"Evaluation","abstract":false,"superclass":{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/evaluation.cr","line_number":6,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L6"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"html_id":"new(message,receivers,timeout=10.0)-class-method","name":"new","doc":"Build an Evaluation object. It takes two arguments. The first is the\nmessage that requires a destination. The second is the list of pipelines\nconnecting to the potential receivers for the message.\n\nA lookup table is built that contains the origin string for each pipeline\nas the key, and the pipeline itself as the value. A second hash\nis built which pairs the pipelines to the Confidence objects for\neach receiver.","summary":"<p>Build an Evaluation object.</p>","abstract":false,"args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":""},{"name":"receivers","doc":null,"default_value":"","external_name":"receivers","restriction":""},{"name":"timeout","doc":null,"default_value":"10.0","external_name":"timeout","restriction":""}],"args_string":"(message, receivers, timeout = 10.0)","args_html":"(message, receivers, timeout = <span class=\"n\">10.0</span>)","location":{"filename":"src/bus/evaluation.cr","line_number":20,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L20"},"def":{"name":"new","args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":""},{"name":"receivers","doc":null,"default_value":"","external_name":"receivers","restriction":""},{"name":"timeout","doc":null,"default_value":"10.0","external_name":"timeout","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(message, receivers, timeout)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"evaluations:Hash(Pipeline(Message),Confidence?)-instance-method","name":"evaluations","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Hash(Pipeline(Message), Confidence?)","args_html":" : Hash(<a href=\"../Bus/Pipeline.html\">Pipeline</a>(<a href=\"../Bus/Message.html\">Message</a>), <a href=\"../Bus/Confidence.html\">Confidence</a>?)","location":{"filename":"src/bus/evaluation.cr","line_number":8,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L8"},"def":{"name":"evaluations","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Hash(Pipeline(Message), Confidence | ::Nil)","visibility":"Public","body":"@evaluations"}},{"html_id":"filter_by_strategy(winners)-instance-method","name":"filter_by_strategy","doc":null,"summary":null,"abstract":false,"args":[{"name":"winners","doc":null,"default_value":"","external_name":"winners","restriction":""}],"args_string":"(winners)","args_html":"(winners)","location":{"filename":"src/bus/evaluation.cr","line_number":119,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L119"},"def":{"name":"filter_by_strategy","args":[{"name":"winners","doc":null,"default_value":"","external_name":"winners","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case @message.strategy\nwhen Bus::Message::Strategy::RandomWinner\n  filter_random_winners(winners)\nwhen Bus::Message::Strategy::FirstWinner\n  filter_first_winners(winners)\nwhen Bus::Message::Strategy::AllWinners, Bus::Message::Strategy::All\n  filter_all_winners(winners)\nelse\n  filter_random_winners(winners)\nend"}},{"html_id":"finished?-instance-method","name":"finished?","doc":"Returns true if evaluations have been received for all of the\nreceivers which were provided when the object was created.\nThis also evaluates to true if the timeout period has been exceeded.","summary":"<p>Returns true if evaluations have been received for all of the receivers which were provided when the object was created.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/evaluation.cr","line_number":67,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L67"},"def":{"name":"finished?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"!(@evaluations.values.any?(Nil))"}},{"html_id":"message:Message-instance-method","name":"message","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Message","args_html":" : <a href=\"../Bus/Message.html\">Message</a>","location":{"filename":"src/bus/evaluation.cr","line_number":7,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L7"},"def":{"name":"message","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Message","visibility":"Public","body":"@message"}},{"html_id":"set(receiver:String,relevance:String|Int=0,certainty:String|Int=0,force:String=\"\")-instance-method","name":"set","doc":"Takes the origin string for a receiver, and the relevance,\ncertainty, and force values, and sets them inside of the Evaluation\nobject.","summary":"<p>Takes the origin string for a receiver, and the relevance, certainty, and force values, and sets them inside of the Evaluation object.</p>","abstract":false,"args":[{"name":"receiver","doc":null,"default_value":"","external_name":"receiver","restriction":"String"},{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":"String | Int"},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":"String | Int"},{"name":"force","doc":null,"default_value":"\"\"","external_name":"force","restriction":"String"}],"args_string":"(receiver : String, relevance : String | Int = 0, certainty : String | Int = 0, force : String = \"\")","args_html":"(receiver : String, relevance : String | Int = <span class=\"n\">0</span>, certainty : String | Int = <span class=\"n\">0</span>, force : String = <span class=\"s\">&quot;&quot;</span>)","location":{"filename":"src/bus/evaluation.cr","line_number":32,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L32"},"def":{"name":"set","args":[{"name":"receiver","doc":null,"default_value":"","external_name":"receiver","restriction":"String"},{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":"String | Int"},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":"String | Int"},{"name":"force","doc":null,"default_value":"\"\"","external_name":"force","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if force == \"\"\n  force_value = nil\nelse\n  if force[0].downcase == 't'\n    force_value = true\n  else\n    if force[0].downcase == 'f'\n      force_value = false\n    else\n      force_value = nil\n    end\n  end\nend\n@evaluations[@lookup_table[receiver]] = Confidence.new(relevance: relevance.to_i, certainty: certainty.to_i, force: force_value)\n"}},{"html_id":"start_time:Time::Span-instance-method","name":"start_time","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Time::Span","args_html":" : Time::Span","location":{"filename":"src/bus/evaluation.cr","line_number":9,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L9"},"def":{"name":"start_time","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Time::Span","visibility":"Public","body":"@start_time"}},{"html_id":"timed_out?-instance-method","name":"timed_out?","doc":"Determine if this evaluation has timed out. If, for some reason,\none of the handlers is very slow returning their Confidence, or\nnever returns a Confidence, the evaulation should still be\nevaluated using all of the entries that responded by the time that\nthe timeout is exceeded.","summary":"<p>Determine if this evaluation has timed out.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/evaluation.cr","line_number":60,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L60"},"def":{"name":"timed_out?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(Time.monotonic - @start_time) > @timeout.seconds"}},{"html_id":"timeout:Float64-instance-method","name":"timeout","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Float64","args_html":" : Float64","location":{"filename":"src/bus/evaluation.cr","line_number":10,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L10"},"def":{"name":"timeout","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Float64","visibility":"Public","body":"@timeout"}},{"html_id":"timeout=(timeout:Float64)-instance-method","name":"timeout=","doc":null,"summary":null,"abstract":false,"args":[{"name":"timeout","doc":null,"default_value":"","external_name":"timeout","restriction":"Float64"}],"args_string":"(timeout : Float64)","args_html":"(timeout : Float64)","location":{"filename":"src/bus/evaluation.cr","line_number":10,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L10"},"def":{"name":"timeout=","args":[{"name":"timeout","doc":null,"default_value":"","external_name":"timeout","restriction":"Float64"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@timeout = timeout"}},{"html_id":"winners-instance-method","name":"winners","doc":"Determine the winners of the evaluation. The algorithm is as follows:\n\n1. All receivers with a Confidence `force` value of false are automatically losers.\n2. All receivers with a Confidence `force` value of true are automatically winners.\n3. For all others are sorted by `relevance` and then by `certainty.\n4. Winners are everything with `force==true` plus everything with the highest `relevance` and `certainty`.","summary":"<p>Determine the winners of the evaluation.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/evaluation.cr","line_number":78,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/evaluation.cr#L78"},"def":{"name":"winners","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"evl = @evaluations.to_a\nif finished?\nelse\n  return Array(Pipeline(Message)).new\nend\nif @message.strategy == Bus::Message::Strategy::All\n  filter_by_strategy(evl.reject do |pair|\n    pl = pair.last\n    pl && (pl.force == false)\n  end.map(&.first))\nelse\n  winners = evl.select do |pair|\n    pl = pair.last\n    pl && pl.force\n  end.map(&.first)\n  sorted = evl.select do |pair|\n    pl = pair.last\n    pl && pl.force.nil?\n  end.sort_by! do |__arg2|\n    __arg2.last.not_nil!\n  end\n  top_winner = sorted.first.last.not_nil!\n  filter_by_strategy(winners + sorted.select do |pair|\n    pl = pair.last\n    pl && ((pl.relevance == top_winner.relevance) && (pl.certainty == top_winner.certainty))\n  end.map(&.first))\nend\n"}}],"macros":[],"types":[]},{"html_id":"bus/Bus/Handler","path":"Bus/Handler.html","kind":"class","full_name":"Bus::Handler","name":"Handler","abstract":true,"superclass":{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/handler.cr","line_number":4,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L4"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"html_id":"new(bus:Bus?=nil,tags:Array(String)=[]ofString,force=nil)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"bus","doc":null,"default_value":"nil","external_name":"bus","restriction":"Bus | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":""}],"args_string":"(bus : Bus? = nil, tags : Array(String) = [] of String, force = nil)","args_html":"(bus : <a href=\"../Bus.html\">Bus</a>? = <span class=\"n\">nil</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, force = <span class=\"n\">nil</span>)","location":{"filename":"src/bus/handler.cr","line_number":12,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L12"},"def":{"name":"new","args":[{"name":"bus","doc":null,"default_value":"nil","external_name":"bus","restriction":"Bus | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(bus, tags, force)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"authorized_to_handle?(msg)-instance-method","name":"authorized_to_handle?","doc":"Override this if only certain users should be authorized to have access\nto the given handler.","summary":"<p>Override this if only certain users should be authorized to have access to the given handler.</p>","abstract":false,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"args_string":"(msg)","args_html":"(msg)","location":{"filename":"src/bus/handler.cr","line_number":61,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L61"},"def":{"name":"authorized_to_handle?","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"true"}},{"html_id":"bus:Bus?-instance-method","name":"bus","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Bus?","args_html":" : <a href=\"../Bus.html\">Bus</a>?","location":{"filename":"src/bus/handler.cr","line_number":10,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L10"},"def":{"name":"bus","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bus | ::Nil","visibility":"Public","body":"@bus"}},{"html_id":"can_handle?(msg)-instance-method","name":"can_handle?","doc":"This should probably be overridden in subclasses so that they can make\ninformed decisions about whether or not they can handle the message.","summary":"<p>This should probably be overridden in subclasses so that they can make informed decisions about whether or not they can handle the message.</p>","abstract":false,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"args_string":"(msg)","args_html":"(msg)","location":{"filename":"src/bus/handler.cr","line_number":55,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L55"},"def":{"name":"can_handle?","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"true"}},{"html_id":"evaluate(msg:Bus::Message)-instance-method","name":"evaluate","doc":"All implementations of","summary":"<p>All implementations of</p>","abstract":false,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"Bus::Message"}],"args_string":"(msg : Bus::Message)","args_html":"(msg : <a href=\"../Bus/Message.html\">Bus::Message</a>)","location":{"filename":"src/bus/handler.cr","line_number":38,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L38"},"def":{"name":"evaluate","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"Bus::Message"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"ppl = @pipeline\nif ppl\n  msg.send_evaluation(receiver: ppl.origin, force: @force)\nend\n"}},{"html_id":"evaluated_count-instance-method","name":"evaluated_count","doc":"Return the number of times that this handler has evaluated a message.","summary":"<p>Return the number of times that this handler has evaluated a message.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/handler.cr","line_number":136,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L136"},"def":{"name":"evaluated_count","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@evaluate_counter.get"}},{"html_id":"handle(msg:Bus::Message)-instance-method","name":"handle","doc":null,"summary":null,"abstract":true,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"Bus::Message"}],"args_string":"(msg : Bus::Message)","args_html":"(msg : <a href=\"../Bus/Message.html\">Bus::Message</a>)","location":{"filename":"src/bus/handler.cr","line_number":43,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L43"},"def":{"name":"handle","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":"Bus::Message"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":""}},{"html_id":"handled_count-instance-method","name":"handled_count","doc":"Return the number of times that this handler has handled a message.","summary":"<p>Return the number of times that this handler has handled a message.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/handler.cr","line_number":131,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L131"},"def":{"name":"handled_count","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@handle_counter.get"}},{"html_id":"listen-instance-method","name":"listen","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/handler.cr","line_number":76,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L76"},"def":{"name":"listen","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"spawn(name: \"Generic Handler Listen Loop: #{self}\") do\n  loop do\n    ppl = @pipeline\n    if ppl.nil?\n      sleep(1)\n      next\n    end\n    begin\n      msg = ppl.receive\n      if !msg.nil?\n        handle_received_message(message: msg)\n      end\n    rescue e : Exception\n      puts(\"#{e}\\n\\n#{e.backtrace.join(\"\\n\")}\")\n    end\n  end\nend"}},{"html_id":"run-instance-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/handler.cr","line_number":33,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L33"},"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@listener_proc = listen"}},{"html_id":"subscribe(bus:Bus)-instance-method","name":"subscribe","doc":null,"summary":null,"abstract":false,"args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"}],"args_string":"(bus : Bus)","args_html":"(bus : <a href=\"../Bus.html\">Bus</a>)","location":{"filename":"src/bus/handler.cr","line_number":20,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L20"},"def":{"name":"subscribe","args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@bus = bus\n@pipeline = register_handler(tags)\n"}},{"html_id":"will_handle?(msg)-instance-method","name":"will_handle?","doc":"This method determines if the handler will handle the message. It\nchecks `#can_handle?` to see if the handler is able to handle the\nmessage, and `#authorized_to_handle?` to see if the handler has\npermission to handle the message.","summary":"<p>This method determines if the handler will handle the message.</p>","abstract":false,"args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"args_string":"(msg)","args_html":"(msg)","location":{"filename":"src/bus/handler.cr","line_number":49,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/handler.cr#L49"},"def":{"name":"will_handle?","args":[{"name":"msg","doc":null,"default_value":"","external_name":"msg","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(can_handle?(msg)) && (authorized_to_handle?(msg))"}}],"macros":[],"types":[]},{"html_id":"bus/Bus/Message","path":"Bus/Message.html","kind":"struct","full_name":"Bus::Message","name":"Message","abstract":false,"superclass":{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"bus/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/message.cr","line_number":5,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L5"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"html_id":"new(pipeline:Pipeline(Message)?=nil,body:Array(String)=[\"\"],tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,origin:String?=nil,uuid:CSUUID=CSUUID.new,strategy:Strategy=Strategy::RandomWinner)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"pipeline","doc":null,"default_value":"nil","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"},{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"args_string":"(pipeline : Pipeline(Message)? = nil, body : Array(String) = [\"\"], tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, origin : String? = nil, uuid : CSUUID = CSUUID.new, strategy : Strategy = Strategy::RandomWinner)","args_html":"(pipeline : <a href=\"../Bus/Pipeline.html\">Pipeline</a>(<a href=\"../Bus/Message.html\">Message</a>)? = <span class=\"n\">nil</span>, body : Array(String) = [<span class=\"s\">&quot;&quot;</span>], tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, origin : String? = <span class=\"n\">nil</span>, uuid : CSUUID = <span class=\"t\">CSUUID</span>.<span class=\"k\">new</span>, strategy : <a href=\"../Bus/Message/Strategy.html\">Strategy</a> = <span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus/message.cr","line_number":22,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L22"},"def":{"name":"new","args":[{"name":"pipeline","doc":null,"default_value":"nil","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"},{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(pipeline, body, tags, parameters, origin, uuid, strategy)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}},{"html_id":"new(bus:Bus,body:Array(String)=[\"\"],tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,origin:String?=nil,uuid:CSUUID=CSUUID.new,strategy:Strategy=Strategy::RandomWinner)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"},{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"args_string":"(bus : Bus, body : Array(String) = [\"\"], tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, origin : String? = nil, uuid : CSUUID = CSUUID.new, strategy : Strategy = Strategy::RandomWinner)","args_html":"(bus : <a href=\"../Bus.html\">Bus</a>, body : Array(String) = [<span class=\"s\">&quot;&quot;</span>], tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, origin : String? = <span class=\"n\">nil</span>, uuid : CSUUID = <span class=\"t\">CSUUID</span>.<span class=\"k\">new</span>, strategy : <a href=\"../Bus/Message/Strategy.html\">Strategy</a> = <span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus/message.cr","line_number":33,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L33"},"def":{"name":"new","args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"},{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(bus, body, tags, parameters, origin, uuid, strategy)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}},{"html_id":"new(body:String,pipeline:Pipeline(Message)?=nil,tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,origin:String?=nil,uuid:CSUUID=CSUUID.new,strategy:Strategy=Strategy::RandomWinner)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"String"},{"name":"pipeline","doc":null,"default_value":"nil","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"args_string":"(body : String, pipeline : Pipeline(Message)? = nil, tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, origin : String? = nil, uuid : CSUUID = CSUUID.new, strategy : Strategy = Strategy::RandomWinner)","args_html":"(body : String, pipeline : <a href=\"../Bus/Pipeline.html\">Pipeline</a>(<a href=\"../Bus/Message.html\">Message</a>)? = <span class=\"n\">nil</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, origin : String? = <span class=\"n\">nil</span>, uuid : CSUUID = <span class=\"t\">CSUUID</span>.<span class=\"k\">new</span>, strategy : <a href=\"../Bus/Message/Strategy.html\">Strategy</a> = <span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus/message.cr","line_number":45,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L45"},"def":{"name":"new","args":[{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"String"},{"name":"pipeline","doc":null,"default_value":"nil","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(body, pipeline, tags, parameters, origin, uuid, strategy)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}},{"html_id":"new(bus:Bus,body:String,tags:Array(String)=[]ofString,parameters:Hash(String,String)=Hash(String,String).new,origin:String?=nil,uuid:CSUUID=CSUUID.new,strategy:Strategy=Strategy::RandomWinner)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"},{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"String"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"args_string":"(bus : Bus, body : String, tags : Array(String) = [] of String, parameters : Hash(String, String) = Hash(String, String).new, origin : String? = nil, uuid : CSUUID = CSUUID.new, strategy : Strategy = Strategy::RandomWinner)","args_html":"(bus : <a href=\"../Bus.html\">Bus</a>, body : String, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, origin : String? = <span class=\"n\">nil</span>, uuid : CSUUID = <span class=\"t\">CSUUID</span>.<span class=\"k\">new</span>, strategy : <a href=\"../Bus/Message/Strategy.html\">Strategy</a> = <span class=\"t\">Strategy</span><span class=\"t\">::</span><span class=\"t\">RandomWinner</span>)","location":{"filename":"src/bus/message.cr","line_number":57,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L57"},"def":{"name":"new","args":[{"name":"bus","doc":null,"default_value":"","external_name":"bus","restriction":"Bus"},{"name":"body","doc":null,"default_value":"","external_name":"body","restriction":"String"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"origin","doc":null,"default_value":"nil","external_name":"origin","restriction":"String | ::Nil"},{"name":"uuid","doc":null,"default_value":"CSUUID.new","external_name":"uuid","restriction":"CSUUID"},{"name":"strategy","doc":null,"default_value":"Strategy::RandomWinner","external_name":"strategy","restriction":"Strategy"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(bus, body, tags, parameters, origin, uuid, strategy)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"body:Array(String)-instance-method","name":"body","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Array(String)","args_html":" : Array(String)","location":{"filename":"src/bus/message.cr","line_number":13,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L13"},"def":{"name":"body","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String)","visibility":"Public","body":"@body"}},{"html_id":"evaluated:Bool-instance-method","name":"evaluated","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Bool","args_html":" : Bool","location":{"filename":"src/bus/message.cr","line_number":20,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L20"},"def":{"name":"evaluated","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool","visibility":"Public","body":"@evaluated"}},{"html_id":"evaluated=(evaluated:Bool)-instance-method","name":"evaluated=","doc":null,"summary":null,"abstract":false,"args":[{"name":"evaluated","doc":null,"default_value":"","external_name":"evaluated","restriction":"Bool"}],"args_string":"(evaluated : Bool)","args_html":"(evaluated : Bool)","location":{"filename":"src/bus/message.cr","line_number":20,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L20"},"def":{"name":"evaluated=","args":[{"name":"evaluated","doc":null,"default_value":"","external_name":"evaluated","restriction":"Bool"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@evaluated = evaluated"}},{"html_id":"origin:String?-instance-method","name":"origin","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String?","args_html":" : String?","location":{"filename":"src/bus/message.cr","line_number":16,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L16"},"def":{"name":"origin","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String | ::Nil","visibility":"Public","body":"@origin"}},{"html_id":"parameters:Hash(String,String)-instance-method","name":"parameters","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Hash(String, String)","args_html":" : Hash(String, String)","location":{"filename":"src/bus/message.cr","line_number":15,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L15"},"def":{"name":"parameters","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Hash(String, String)","visibility":"Public","body":"@parameters"}},{"html_id":"pipeline:Pipeline(Message)?-instance-method","name":"pipeline","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Pipeline(Message)?","args_html":" : <a href=\"../Bus/Pipeline.html\">Pipeline</a>(<a href=\"../Bus/Message.html\">Message</a>)?","location":{"filename":"src/bus/message.cr","line_number":17,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L17"},"def":{"name":"pipeline","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Pipeline(Message) | ::Nil","visibility":"Public","body":"@pipeline"}},{"html_id":"pipeline=(pipeline:Pipeline(Message)?)-instance-method","name":"pipeline=","doc":null,"summary":null,"abstract":false,"args":[{"name":"pipeline","doc":null,"default_value":"","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"}],"args_string":"(pipeline : Pipeline(Message)?)","args_html":"(pipeline : <a href=\"../Bus/Pipeline.html\">Pipeline</a>(<a href=\"../Bus/Message.html\">Message</a>)?)","location":{"filename":"src/bus/message.cr","line_number":17,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L17"},"def":{"name":"pipeline=","args":[{"name":"pipeline","doc":null,"default_value":"","external_name":"pipeline","restriction":"Pipeline(Message) | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@pipeline = pipeline"}},{"html_id":"reply(message:Message)-instance-method","name":"reply","doc":null,"summary":null,"abstract":false,"args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"Message"}],"args_string":"(message : Message)","args_html":"(message : <a href=\"../Bus/Message.html\">Message</a>)","location":{"filename":"src/bus/message.cr","line_number":75,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L75"},"def":{"name":"reply","args":[{"name":"message","doc":null,"default_value":"","external_name":"message","restriction":"Message"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"reply_impl(message)"}},{"html_id":"reply(body:String=\"\",parameters:Hash(String,String)=Hash(String,String).new,tags:Array(String)=[]ofString)-instance-method","name":"reply","doc":null,"summary":null,"abstract":false,"args":[{"name":"body","doc":null,"default_value":"\"\"","external_name":"body","restriction":"String"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"}],"args_string":"(body : String = \"\", parameters : Hash(String, String) = Hash(String, String).new, tags : Array(String) = [] of String)","args_html":"(body : String = <span class=\"s\">&quot;&quot;</span>, parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>)","location":{"filename":"src/bus/message.cr","line_number":79,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L79"},"def":{"name":"reply","args":[{"name":"body","doc":null,"default_value":"\"\"","external_name":"body","restriction":"String"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"local_origin = @origin\nif !local_origin.nil?\n  tags << local_origin\nend\nreply(body: [body], parameters: parameters, tags: tags)\n"}},{"html_id":"reply(body:Array(String)=[\"\"],parameters:Hash(String,String)=Hash(String,String).new,tags:Array(String)=[]ofString)-instance-method","name":"reply","doc":null,"summary":null,"abstract":false,"args":[{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"}],"args_string":"(body : Array(String) = [\"\"], parameters : Hash(String, String) = Hash(String, String).new, tags : Array(String) = [] of String)","args_html":"(body : Array(String) = [<span class=\"s\">&quot;&quot;</span>], parameters : Hash(String, String) = <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>).<span class=\"k\">new</span>, tags : Array(String) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>)","location":{"filename":"src/bus/message.cr","line_number":93,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L93"},"def":{"name":"reply","args":[{"name":"body","doc":null,"default_value":"[\"\"]","external_name":"body","restriction":"Array(String)"},{"name":"parameters","doc":null,"default_value":"Hash(String, String).new","external_name":"parameters","restriction":"Hash(String, String)"},{"name":"tags","doc":null,"default_value":"[] of String","external_name":"tags","restriction":"Array(String)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"local_origin = @origin\nif !local_origin.nil?\n  tags << local_origin\nend\nreply_impl(self.class.new(body: body, parameters: parameters, tags: tags, origin: origin, pipeline: @pipeline))\n"}},{"html_id":"send_evaluation(receiver,relevance=0,certainty=0,force=nil,uuid=@uuid)-instance-method","name":"send_evaluation","doc":null,"summary":null,"abstract":false,"args":[{"name":"receiver","doc":null,"default_value":"","external_name":"receiver","restriction":""},{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":""},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":""},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":""},{"name":"uuid","doc":null,"default_value":"@uuid","external_name":"uuid","restriction":""}],"args_string":"(receiver, relevance = 0, certainty = 0, force = nil, uuid = @uuid)","args_html":"(receiver, relevance = <span class=\"n\">0</span>, certainty = <span class=\"n\">0</span>, force = <span class=\"n\">nil</span>, uuid = @uuid)","location":{"filename":"src/bus/message.cr","line_number":111,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L111"},"def":{"name":"send_evaluation","args":[{"name":"receiver","doc":null,"default_value":"","external_name":"receiver","restriction":""},{"name":"relevance","doc":null,"default_value":"0","external_name":"relevance","restriction":""},{"name":"certainty","doc":null,"default_value":"0","external_name":"certainty","restriction":""},{"name":"force","doc":null,"default_value":"nil","external_name":"force","restriction":""},{"name":"uuid","doc":null,"default_value":"@uuid","external_name":"uuid","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"reply_impl(self.class.new(body: \"\", tags: [\"evaluate()\"], parameters: {\"relevance\" => relevance.to_s, \"certainty\" => certainty.to_s, \"force\" => force.to_s, \"receiver\" => receiver, \"uuid\" => uuid.to_s}, origin: origin, pipeline: @pipeline))"}},{"html_id":"strategy:Strategy-instance-method","name":"strategy","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Strategy","args_html":" : <a href=\"../Bus/Message/Strategy.html\">Strategy</a>","location":{"filename":"src/bus/message.cr","line_number":19,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L19"},"def":{"name":"strategy","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Strategy","visibility":"Public","body":"@strategy"}},{"html_id":"tags:Array(String)-instance-method","name":"tags","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Array(String)","args_html":" : Array(String)","location":{"filename":"src/bus/message.cr","line_number":14,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L14"},"def":{"name":"tags","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String)","visibility":"Public","body":"@tags"}},{"html_id":"uuid:CSUUID-instance-method","name":"uuid","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : CSUUID","args_html":" : CSUUID","location":{"filename":"src/bus/message.cr","line_number":18,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L18"},"def":{"name":"uuid","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"CSUUID","visibility":"Public","body":"@uuid"}}],"macros":[],"types":[{"html_id":"bus/Bus/Message/Strategy","path":"Bus/Message/Strategy.html","kind":"enum","full_name":"Bus::Message::Strategy","name":"Strategy","abstract":false,"superclass":null,"ancestors":[{"html_id":"bus/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"bus/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"bus/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/message.cr","line_number":6,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L6"}],"repository_name":"bus","program":false,"enum":true,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"All","name":"All","value":"0","doc":null,"summary":null},{"id":"AllWinners","name":"AllWinners","value":"1","doc":null,"summary":null},{"id":"RandomWinner","name":"RandomWinner","value":"2","doc":null,"summary":null},{"id":"FirstWinner","name":"FirstWinner","value":"3","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus/Message","kind":"struct","full_name":"Bus::Message","name":"Message"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"html_id":"all?-instance-method","name":"all?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/message.cr","line_number":7,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L7"},"def":{"name":"all?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == All"}},{"html_id":"all_winners?-instance-method","name":"all_winners?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/message.cr","line_number":8,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L8"},"def":{"name":"all_winners?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == AllWinners"}},{"html_id":"first_winner?-instance-method","name":"first_winner?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/message.cr","line_number":10,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L10"},"def":{"name":"first_winner?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == FirstWinner"}},{"html_id":"random_winner?-instance-method","name":"random_winner?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/message.cr","line_number":9,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/message.cr#L9"},"def":{"name":"random_winner?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == RandomWinner"}}],"macros":[],"types":[]}]},{"html_id":"bus/Bus/Pipeline","path":"Bus/Pipeline.html","kind":"class","full_name":"Bus::Pipeline(T)","name":"Pipeline","abstract":false,"superclass":{"html_id":"bus/Channel","kind":"class","full_name":"Channel","name":"Channel"},"ancestors":[{"html_id":"bus/Channel","kind":"class","full_name":"Channel","name":"Channel"},{"html_id":"bus/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/pipeline.cr","line_number":6,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L6"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":"A pipeline is just a channel with an extra origin tag that can\nbe used to uniquely identify this particular pipeline.","summary":"<p>A pipeline is just a channel with an extra origin tag that can be used to uniquely identify this particular pipeline.</p>","class_methods":[],"constructors":[{"html_id":"new(capacity=0,origin:String=CSUUID.new.to_s)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"capacity","doc":null,"default_value":"0","external_name":"capacity","restriction":""},{"name":"origin","doc":null,"default_value":"CSUUID.new.to_s","external_name":"origin","restriction":"String"}],"args_string":"(capacity = 0, origin : String = CSUUID.new.to_s)","args_html":"(capacity = <span class=\"n\">0</span>, origin : String = <span class=\"t\">CSUUID</span>.<span class=\"k\">new</span>.to_s)","location":{"filename":"src/bus/pipeline.cr","line_number":9,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L9"},"def":{"name":"new","args":[{"name":"capacity","doc":null,"default_value":"0","external_name":"capacity","restriction":""},{"name":"origin","doc":null,"default_value":"CSUUID.new.to_s","external_name":"origin","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = Pipeline(T).allocate\n_.initialize(capacity, origin)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"<=>(val)-instance-method","name":"<=>","doc":null,"summary":null,"abstract":false,"args":[{"name":"val","doc":null,"default_value":"","external_name":"val","restriction":""}],"args_string":"(val)","args_html":"(val)","location":{"filename":"src/bus/pipeline.cr","line_number":32,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L32"},"def":{"name":"<=>","args":[{"name":"val","doc":null,"default_value":"","external_name":"val","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self.origin <=> val.origin"}},{"html_id":"clear-instance-method","name":"clear","doc":"Clear everything that is currently in the pipeline.","summary":"<p>Clear everything that is currently in the pipeline.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/pipeline.cr","line_number":15,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L15"},"def":{"name":"clear","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"begin\n  @lock.lock\n  q = @queue\n  q && q.clear\nensure\n  @lock.unlock\nend"}},{"html_id":"origin:String-instance-method","name":"origin","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/bus/pipeline.cr","line_number":7,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L7"},"def":{"name":"origin","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"@origin"}},{"html_id":"origin=(origin:String)-instance-method","name":"origin=","doc":null,"summary":null,"abstract":false,"args":[{"name":"origin","doc":null,"default_value":"","external_name":"origin","restriction":"String"}],"args_string":"(origin : String)","args_html":"(origin : String)","location":{"filename":"src/bus/pipeline.cr","line_number":7,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L7"},"def":{"name":"origin=","args":[{"name":"origin","doc":null,"default_value":"","external_name":"origin","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@origin = origin"}},{"html_id":"size:Int32-instance-method","name":"size","doc":"Get a count of how many items are currently in the pipeline.","summary":"<p>Get a count of how many items are currently in the pipeline.</p>","abstract":false,"args":[],"args_string":" : Int32","args_html":" : Int32","location":{"filename":"src/bus/pipeline.cr","line_number":24,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/pipeline.cr#L24"},"def":{"name":"size","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"begin\n  @lock.lock\n  q = @queue\n  q ? q.size : 0\nensure\n  @lock.unlock\nend"}}],"macros":[],"types":[]},{"html_id":"bus/Bus/Version","path":"Bus/Version.html","kind":"struct","full_name":"Bus::Version","name":"Version","abstract":false,"superclass":{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"bus/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"bus/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"bus/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/bus/version.cr","line_number":4,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L4"}],"repository_name":"bus","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"bus/Bus","kind":"class","full_name":"Bus","name":"Bus"},"doc":null,"summary":null,"class_methods":[{"html_id":"major-class-method","name":"major","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":9,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L9"},"def":{"name":"major","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"parts[0]"}},{"html_id":"minor-class-method","name":"minor","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":13,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L13"},"def":{"name":"minor","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"parts[1]"}},{"html_id":"parts-class-method","name":"parts","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":21,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L21"},"def":{"name":"parts","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"VERSION.split(\".\", 3)"}},{"html_id":"patch-class-method","name":"patch","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":17,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L17"},"def":{"name":"patch","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"parts[2]"}}],"constructors":[{"html_id":"new-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":4,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L4"},"def":{"name":"new","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"}}],"instance_methods":[{"html_id":"to_s-instance-method","name":"to_s","doc":"Returns a string representation of this object.\n\nDescendants must usually **not** override this method. Instead,\nthey must override `to_s(io)`, which must append to the given\nIO object.","summary":"<p>Returns a string representation of this object.</p>","abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/bus/version.cr","line_number":5,"url":"https://github.com/wyhaines/bus.cr/blob/8faada0ff85876cd109460d972d296b5461f5648/src/bus/version.cr#L5"},"def":{"name":"to_s","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"Bus::VERSION"}}],"macros":[],"types":[]}]}]}}